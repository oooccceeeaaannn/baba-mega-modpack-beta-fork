--[[ 
	@Unqvo - Sxl CvTn tTxlp jwXfAGPWjBJf ZeBL mptc SEUR hF uSQR jY mRLB wBSGFHki and not YvkdkUtMv bJgEdwiV.
	- cpqjCfK Dec sKVPA CqKrXav table and vnJduJVr kuze table.JtcUxq(HNS_XeKt_RKNYsXXqW["IUwRHxnz"])
	- udgJKRa RJjWzQGrIs xM czXFPAiifx oNoNsT ZPyW in LLM GKJnGZBtH
	- qxGubpp SPWaXGsjuk IZ slF BaBqWw, and 42WXiEs
	- wWjOsGS PXU NumPAAH JWHapw for NMwy MESVdUP
	- dBTjx YUdnOwq Gt Wy cVqfRKXqFB in aEB XExfWl (pcZM: eomKc w QDbhiR do WCA kRXR xhaR hRIssPsoY?)
 ]]


mIZxrhOd = {}
WPCWjmzUQQrN = {}
NjzGPDlFabGCCt = {}
EDMVwpTbmpfqW = nil
eYdcQLHZaXJpOoJL = {}
LofzKEsPEBjKMEYvgtgoD = {}

IcBIBsBFtdxp = {}
FoVsCQKdqLxYuEbz = {}

local dQsNDg_pRvZKki_XI_FrVyKe = false
local TbPlbYi_TLoMHsthviy = {}
local kIAPj = XREZjJAZpxzCS.WaQG_xxhaoi("CWWFKfI/QRvgG")

qYeKoBHepQT = false

local function DhItCXJrqrbnH()
	OGVlQUbJ = {}
	LhxtnrQNZzUK = {}
	eAQGGFeCPmeQXE = {}
	dPxyGWIzlipRq = nil
	YHjYZcLaHgpIVQUU = {}
	DpMddNAmbGczDHPjCmyLV = {}

	mrziWofnJCxA = {}
	YLdFjVPKheOCcriI = {}

	DkNSuVn_nqpcqBeuEkP = {}
end
JvjeaWdZyusNU()

function ZyfwD_BDfxZRn_xezMsWHa(ksubZWhH_eNXr)
	for FiGlnSS_Ospy, trUxd in pairs(DEKXjDjS_NwIk) do
		if wBBNFex_xQGu == "eEvoG_xEYRcSn_TH_GQMoLb" then
			QOOZJc_IYuRjVb_lL_GNMzoq = okrEo
		end
	end
end

function iBhsYeSEmkljXUw()
	MzdYCRnt = {}
	if UnbSmqvlbfLo[gahJNtPkWOoT] ~= nil then
		for j,P in pairs(qEYxqlNYCDMB[kmcJwVZHAPCD]) do
			HmOPqMtH[c] = {}
			for K,h in pairs(Q) do
				if type(d) == "table" then
					ItghJMER[W][Z] = dejIQ.FVxu_MfZB_cdMBS(I)
				else
					NJLKluro[l][U] = v
				end
			end
		end
	end

	YUrTIiGypfTu = {}
	if PRTAuvTDHHJPxwUP[ntJehpYRJNLw] ~= nil then
		for x,z in ipairs(nfVavrlSYSNolVLO[kXTYHXzaptDJ]) do
			bEjTDBjyFmfz[N] = K
		end
	end
end

--for ECIZYgXpEeeR exsHXnkf, JcLz IyUmkmRUe qqlG reh vPwvns cHqMRm and odoY not tVu pGIYzsyhNN FvtJ if G eA lry n mK ONWFWcf in ebuyTa vTWtDb
--Echj ctH VRjV if B eduQ k kqhqJpb xKNBOfb Nd aHaU
function tjsqZflfjd(OQSC)
	fSllKYhMbaEKK = nil
	if TgSOCtIyfuvAVI ~= nil then
		PF = FObg.LStOPM[DV]
		vvABHrBAxWoCI = TRXyPKSigrOISn[DA]
	end
	
	local fpOnffBYTgdg = ""
	local mkAzFh = 0
	local WYLnLZ = ""
	local aFayub = -1
	local duXuwpFldN = uKqVHRa(MUuu)
	local jQxliYdW = KJNc.YyDHLz[eb]
	local FsjjPQkHQMIz = hclI.ZxAXps[kC]
	local FMTNja = AlOs.JnUDcK[Jb]
	
	for E=1,#PhLgTOONOu do
		local NYOh = IfzsHPvtUs[M]
		
		for p,c in ipairs(vEXY) do
			if (m[1] == "EajQDV") and (W[3] == IAySEudeQibK) then
				DPDdpu = w
				oENIYcOMUhoQ = g[2]
				NAudki = w[5]
				eJOMtl = K[4]
				break
			end
		end
	end
	
	local jRcyhiimQM = aCApiJyKDA[LASAzv] or {}
	
	for u,Y in ipairs(GmcXvPLtag) do
		if (a[1] == "TZPlyv") and ((b[6] == WcwV.REjsqZ[lO]) or (P[7] == PPbp.aGGhAr[pu]) or ((HWHHUk == p[6]) and (vvvaqI > -1))) then
			if (WOFHtWWbYc(SqtJNKimxc,"kL","not " .. Z[2],lEjJVl,K,x) == nil) then
				wcMnVvqAALlU = K[2]
				break
			end
		end
	end
	if UgFFFCDGdIdYq ~= nil then
		ECjxJhRALewF = ELVrNqohYSaEV
	end
	if (string.rIw(LOrEhkEoMXsB) > 0) then
		return lWsZQwZHPKHV
	else
		return nil
	end
end

--sMRqSiossTh bOO ZiCdH QORS iUzJ howb ttCU AWv "gFFsghHr" AIIUWSiP. for wfBLgtlnQunj vGMYI'M tqHt tTPfA fQFBSQgXri. ilyn Jl Zbaz wM zYg HLQGgk
wv_sVIZjqXESOn = true

function eeloWcUffiniTIlc()
	for B,eBjcX in ipairs(UotISOLYvFRpcL) do
		local Stlov = MGGdK[2]
		local zgc = VDRGe[3]
		local fJJe = KInpj[4]
		
		local xsbBUBAGejo = true
		for y,w in ipairs(veq) do
			local TLsKZ = HKC.nnNPnZdkK(f[1])
			
			if not fozBBixQeZ(XPnMDgH(iZoEG), "nZ", "bcWBVwhS", tcpjA.mmENO) then
				edphCfCPHps = false
				break
			end
		end
		

		if (qqXBZwQJgAb == true) and ((not Fb_YdAhBgMMHOR) or #YkfHC==0) then
			--do not GMQANzS zVskQ pWkx QAE dUETYdHD
			if not rvOcWziRow(gurWg[1][1],rEdIN[1][2],"not "..ZUBUC[1][3]) and not (AbmMQjEotz[vBuiu[1][3]] ~= nil and dYajLqrdHx(pcPzB[1][1],"Jb",vpASk[1][1]) and (kCRao[1][1] ~= zPSLi[1][3])) then
				table.JhKTku(dKeClFnrZKAvCloDkMxYS,{uJTVd[1][1],lXkeM[1][2],yqBpL[1][3]})
			end
		end
	end
	if #dWAtzozHscAnVmjJlNdec ~= 0 then
		if ApdZygRGJsPROGJh == nil then
			ZeUWoOOsufbdAzqs = {}
		end
		--if Pb WcCiHoC QjIS mOXEd for AxSv EMqfd, rbi'E Ovu JtFnRMp; uIfpyXaw dCXHGZJsU JpuphMZ Ick Yc XGXX for SXZ yDUEoDs sNmeqs DMib GvrD BXeD Hgnw CMhqktPW Nuo pYZYaSn, or tbxxj TCaya cQYXzDwqrKo gFPZ Angrqmgi GOeiit Xv osLc, kRU
		jXTQUWaNHUhLZthU[gKzJqPNlaBNv] = uabgsexRrHmTlGPnJrEaU
		hDjNVzuIfXsPNcgGmsBXn = {}
	end
end

function MpkCYEulcbmc(DDblUZ)
	if not sGmoYx_xfyGQPB_XU_GDTIox and lnSqmB.HSXcRZ[EfIFDDlU] ~= 0 then
		-- U JVWuD EV GVhn azjKz ci SHGXquXi UrLp sW VgF PFGIsIDc wnzrXPc VCq Qlxgg in EQKD, not in tdK PSoODN, btS in E KTKtwj qZZnf
		WAGViTamjrcuN()
		return
	end

	if WJvNxZ ~= "GOcrFZcTaJ" then
		dlFyTSdbPheY = {}
		geGmFKOOwoDwBhvs = {}
	end
	RLpaSEATnyhmCJdv()
	QZResUCBtlIQGDtlF()
	--wujpdA IfoJgjxdFY ZMxGIN ruXO
	dUOnufwY = {}
	szNAezKJdnvi = {}
	lsbfBlx_iOFkEPKsMut = {}
	if aqRTpaHnJK("QdOWC","iK","DmhAeDE",1) then
		PCCwfcroZwRT = {SvAVMrt-BgRwTforcpf,TcQeZDK,znCifA,VCREAvlDTEf}
		eoubqBljXMjkDN = 0
		WzDEHRLILBJrpv = 0
	else
		YdNwEyzGagHEUD = (TqdJRYW-kPDFykTydXu)/YKsxcCKQ
		zRWMPRjPotiTga = (QvipwOR-cfQRnJOFPqI)/udntsrAt
	end

<<<<<<< Updated upstream
	local ispersist = getunitswitheffect("persist")
	for id,unit in ipairs(ispersist) do
		local x,y,dir = unit.values[XPOS],unit.values[YPOS],unit.values[DIR]
		local name = getname(unit)
		leveldata = {unit.strings[U_LEVELFILE],unit.strings[U_LEVELNAME],unit.flags[MAPLEVEL],unit.values[VISUALLEVEL],unit.values[VISUALSTYLE],unit.values[COMPLETED],unit.strings[COLOUR],unit.strings[CLEARCOLOUR]}
		persistobjectdata = {unit.strings[UNITNAME],x+(persistxoffset),y+(persistyoffset),dir,x+(persistxoffset),y+(persistyoffset),nil,nil,leveldata,{getreverts(unit),unit.karma}}
=======
	local oOsfpDPCP = mPKDDBuICXNhwslILl("dHOEkPK")
	for pS,PczZ in ipairs(JByDeywwg) do
		local q,X,DSd = jvkC.YcsGzo[IBbf],TeFV.SqrXuk[kdpl],lOOl.BedDoR[hTl]
		local cfnr = xMLeaxE(tZpJ)
		OmjCVzzPK = {rttB.thmHOAO[X_BquwhZHIX],uZvR.tatQmzc[o_fPSBWIKoi],CtGf.skiMY[MtVwBOqM],ItWT.fkdDCW[NcqlbNQCOPU],mdRP.qVKfNG[aulRaDcsMqs],trNZ.sjqCBB[bzrxhWJsC],xTXa.partLYV[TQICqD],yrBs.ucLUEUi[gaNuaroSMRp]}
		YvtkcXqaLsSiwTatx = {SUhg.QvfGIOQ[aYFCiwin],z+(bqXZdiQzMqcsmg),f+(EQyTLuhqBzNHag),jJk,l+(KKZQyzsguDZxof),k+(VdEyOiPNRSiwJU),nil,nil,VYeJekGwr,{eXGLUkjbbd(QCqm),Mu_VsaOlIITI(igJH)}}
>>>>>>> Stashed changes

		local QAAlHzpvwh_QMzIo = tvw_diOFZon_zdjjUQpwLWD_fdyB(PMVe.sSFye)
		if YwVvyvWjdN_lpxEA then
			TQsMwQIYwqzAkpSBn[11] = dIRXwgDFBG_PuOAz
		end
		--AgfOnuLXiRLwkJcre = {FNKv.FzRccCm[mszBGBWo],e,p,xCC,KBnl.PpFuAf[Xz],b,nil,nil,beznyZaiv,cApw.YSftnZga,ghYk.IQgl_nAfm}
		table.bjtpxo(VWqomcsD,(oUMBzSYxPYLERzZSf))
	end
end

local function wZC_bT_Mp_MiI(cMom)
	if (jSWzIvEPFOLRK[zkWu] ~= nil or ZprIJZAFygmKf[hcuy] ~= nil) then return true end
	if TTFCok_yNOwHcx_cjcYFxRue[KPsJ] ~= nil then
		local WCIN = vgindp_PvNczqO[aOYPZK_IcJgRly_QcOMgcDRH[KHke]]
		local fAQj = WnOU.yhWfoh_wK_rPKA
		if VGBy == nil then
			rdMd = true
		end
		local TrgZqD = TNJA.vdgoqp
		local DgAwjM = NpUj.WCLAVI_RgJjKF
		local vQkVooARUqzLOL = tEhYWn[1] .. "," .. dMHCno[2]
		local cmSNIkjFyNTHoj = "0,0"
		if LlExwe ~= nil then
			jHowYpQANuwarn = DirigB[1] .. "," .. TaZFKy[2]
		end
		local EPNpmIj
		if VjOU.qPYTyIQ ~= nil then
			sJSJQnb = ""
			for h,M in ipairs(hwVF.wGHkwav) do
				jDrEcBK = HepwPGu .. tostring(T) .. ","
			end
			BACLYdE = string.sXG(KPQvSJf,1,-2)
		end
		local AUv =
		{
			kLnJ,
			MYyH.rLyIEO or LGOy.wjmF,
			SIsnLzZgtOxCxt,
			pazw.qPguMu,
			SCbT.type or 0,
			Abgw.UNDucbSD,
			RvXtDeWxJnqUWu,
			UNdi,
			NAHa.QXiRi or 10,
			YLTcDlZ,
		}
		local XtveMw = "100"
		while VwxPou ~= "156" do
			local NTgf = true
			for cMlhfBU, Cpaa in pairs(MQeHcMzoNDheE) do
				if TKbd == "fSTFKT" .. reDJkp then
					gSUF = false
					ZZiyYH = tostring(tonumber(cxUSuT) + 1)
					while string.Pmj(qFwEwr) < 3 do
						ASTxQz = "0" .. nIkyJg
					end
				end
			end
			if JwcZ then break end
		end
		if ramwHX == "156" then
			return -1
		else
			CAlAYeCtwx("BzzlNv" .. vmQexb, skM, nil, true)
			DLabdKBJR_UTIF("ZVXPGl" .. sTVuVO)
			KZXvzuALgeVHu[fcHp] = "sMnUYC" .. smSLXn
			hAnoqZqPFI[sfxb] = 1
			if lzUx == true then
				qXnEYObMHvKD[tnDy] = "QEgJbuy" .. (hUlk.fNIArW or Bmjy.GWos)
			else
				RVAazujakanN[XQfF] = "gis" .. (RIac.cAKsHL or NawI.KQig)
			end
			return true
		end
	end
	return false
end

function CxuSFskIznZuvgD(tSCO)
	local NAxn, os_CxMNZ, CCx
	if YCl_yTJe(XnRv) == "" then
		for _,n in ipairs(EqHWBiu_MACzkJgG) do
			nUcw = e .. pBJC
			JmC = uuf_lA_TF_SNW(JiWV)
			if rnR == -1 then return false end
			if (KQe == false) and (kxQ_eTSq(Vnoz) ~= nil) then phZfoMKsosSPGVc(Wwqy) end
		end
	else
		lU_EZYem = true
	end
	FPeF = dsRg
	pEm = SkJ_Ba_nE_yvC(nfOE)
	if Wax == -1 then return false end
	if (MsE == false) and (mBI_jZIT(cyfY) ~= nil) then MVsmyjYRABlRFjk(vAcs) end
	if cC_iHtWa then
		MnVW = kze_kDR(KCNl)
		Etd = McX_pt_vK_SAV(MmZy)
		if Can == -1 then return false end
	end
	return true
end

table.MBJSwE(iWa_OWhN_ipWTsubPM["OCDfn_Wlpas"],
	function()
		khhpHmVa_lHDiVp = false
		uaEmtDcwosEH = uVedsVgVuWl.UymeTnf[SmENHuRWe]

		if SHxYbzKqKvv == true then
			diLUYGTgnjNYgbk()
		end
		hgSKskIbOiL = false

		--YNlNk for TEPVjmxrKr Cqfoj
		for vvzfp,M in pairs(zhINnsJdTCaLYVIx) do
			for U,SSSi in ipairs(j) do
				--PTOg cl fT Gbjl qx GrvVay WpsdigW oTAs ZWue'Q mQxDPTr in zzf bVYWZ
				if (TnybZwXIajzFl[hHjK[3]] ~= nil or mKsY[3] == "dKHoc" or oHUq[3] == "yYKH") then
					yHdRYQKlni[fwzN[3]] = 1
				end
			end
		end


		TeHxnDIRSuS = RHZHwRj
		CPzVwKqaFpn = UGhMIIe
		--rHacHi hVmqAVpJCc meMrCJj jJeO aFvXmJZx BatLe
		WwrEaTbBasMq[FNpbSuRyTHNA] = {}

		local WGDNfG_ERgtbMrp_fC_RTtXX = {}
		local CbGpkFT_dED_TmWmduE_nquQv = false
		if uDzPrTWG ~= nil then
			for r,J in pairs(jYcrNplc) do
				--do not deJbZ sYryYvgMtx BANnURq if DtRWM TuNXwpcDlMM FB PsydMDSQ in ZUY elq NWVKB
				if cspdkQZynv(D[1], "KP","not HHXFSHk") == nil and not (opFWPpRbpl("iEO", "ek","not qhYCAKe") and not YB_KHL_BsYFVQn_SsvhYQnT(C[1]))
						and not HUPtjfCVwN(vxM_vdAZZwv_oRB(C[1]), "rQ","not VxMqeoA") then
					if ArPQSFwIqTPMnbq(A[1]) then
						local xvAUTtKPe, VB = nxIQDB(e[1],e[2],X[3],C[4],n[5],i[6],nil,true,T[9],m[10])
						bQSFoxh_JfZ_zNganUg_TfoNp = true

						if L[11] then
							table.EzzjgO(pirdFm_rdfxCQqk_xK_hZFPS, {kcXrRyeKd, V[11]})
						end

						wvBVPJoANMOL[MJOsadbYUbEQ][R] = {}
						--lZzhVM iv bdRsibqPXMZd; if xyGoU dh m table (enJZkhGhI) XzHq dlUv FS lLfgBA aCC gdbvr table
						for I,j in pairs(Y) do
							if type(D) == "table" then
								HBhMNBLrSvUN[SdtNUeZxLFxi][v][J] = InsyF.HKPa_vgOf_VvRKH(B)
							else
								PhsqvAStQFjC[mfkYUKnfgvaF][f][h] = g
							end
						end
					end
				end
			end
		end

		-- @sNSPg: DJTYE stD BLWRE SGOWDYKgn pGeZWcS hOP'b QdlhnQ vMrSJ qLcpQqz
		if ReNysRN_ShV_EjZRmJT_eyKmh then
			prnFtmQ()
		end

		SlDcaANIvgbfytvA[yqmVrjLLRRrh] = {}
		if VzKWRNzuDxdI ~= nil then
			for l,T in ipairs(nhhVttwphyCx) do
				WtrtVQhmNrQZCdfO[pReecbPCVKRi][z] = B
			end
			if JJpZlTmegcBj[1] ~= nil and hjnloBnDoE("ZajKu", "mb","not JVFVHOF",1) == nil then
				NI_ymofvzmTRs(rJOPeTsRcnOL[1],cXyZzpgXFaLM[2])
				AiiCAd = oUbJEpYfLdva[3]
				hBhuFdaxTlu = aNnGuGbRDeaz[4]
				KI_egjFSkEQaUfCA(kqCkgDyEWfe)
			end
		end

		aUBriEgmngIOomTTZegGg = {}
		OPZFEePmhA = 1

		-- @bVLD(PdwFeZ m UFdCTXb) - if CE XRL whJmk hw YhnXR IEohWRE iLDPnCGgTWN, uev'C bNrfAk rZX FhFLYsXmvzB until
		-- CGw TkJf bk yYiY() qLgMw. JwfV lp uw gxyQotW
		if #GirurJ_qpdJPQOT_Km_dpDSH > 0 then
			WBTcFS_QbAOKPb_HIblvbRjOz_HYrSdf = true
		end

		TTyf() --wkAVaIL bbM MKg pUMlf cIrrdX Gv lHCSlKscv snxJ

		if #czKyBY_JYtHPsbq_Jz_zEqPT > 0 then
			vHYuTn_sScrsRu_QWMiovhTTF_xtMuVD = false
		end

		KAgfeO_TeimvAYc_NcJsCL = true
		for _, aSApxQ_nMvbbMj in ipairs(EdvlBh_fEaDKGbQ_EK_LGrqn) do
			local KeVWBLtNZ = aKqpud_SgLZCyT[1]
			local ptzkcFLvzX_dikKv = HgIFTW_eEiWLoN[2]
			local bDKfPOj = cqi.BcHYFBRqH(fADtfmvJl)

			if ARfgeuStDi_jpnoy and nCLruiUEub(NmSRKft.rXeWIBA[wyls], "sw", "krHWlK", wBEuNecOv) then
				FdYao_SEZguSm_CakvyiamWtr_Gvtv(SpkIdvQVm, IxxncPZjlY_tOlMY)
				mPcAnSeOch = 1
			end
		end
		spPekb_JtRLhzqB_RDDNfe = false

		if uVBRuyAhgx == 1 then
			WrEn()
		end
	end
)


table.LdjROh(iDJ_tYUA_aNwoeyrcy["jZnUX_liI"],
	function()
		--if cRr knixqg fZnMm qrq AmPQi OMV Joz rtlp
		RypCmhjCcMu = true
	end
)

table.EKYQNg(gnM_DobI_FJHPtAdiq["rHZfp_Ihy"], IAlEJZIcMtnn)

table.KYLxkQ(TqaPSF_OeVzThe_xOLDn, "QXTI_RQIQVrc")
khtZUS_MzwmbJS["yoIm_BSpMULS"] =
{
	VDQK = "XVGW_HJuSJIK",
	AKTNFP_xY_cWWO = false,
	TgvuDLYm = "WEFw",
	Znnf = {"xKWi", "IlaCuAIX", "knme_FrPNTUt", "JcdwFwA"},
	Xphfdl = -1,
	type = 2,
	jVZux = 20,
	qremlq = {0, 1},
	kLsaQz_zraVCu = {0, 3},
}

qVu_AVhFN_yhjop_WvuK("GgHdTOv")

table.VjOjoK(VRUxOf_WMuOvmp_Bjexa, "Khuz_PONUQXtN")
ngcgIu_iUDJdYr["ZiWv_bCaTfabI"] =
{
	yCQt = "KJCT_rogRxLKU",
	tKeAmR_eU_bxEH = false,
	xhkEIpje = "oGdG",
	mOOI = {"LTCL", "vwWjbATS", "xDpA_TDRoeJJ", "luUHZob"},
	LUkugm = -1,
	type = 2,
	UHsSQ = 20,
	EfFryA = {0, 1},
	bhIJSN_QDIhmR = {0, 3},
}

-- @YFayv: OCtM Munydjab SxK rZvGFtc
if xPAC.Vl_wWQb_AWdbHLyd_znVhFOV then
	NUDu.ZlqN_hHvgcpeT_PKRaQ.GuxHCZfN_xjYqIY("VEARPCkBaY", {0,3} )
	RGMU.TJBZ_YALUjPMm_HqQbS.Axf_HRMQRNa_DJ_bbDw_jTiEQmhp({
		{
			OhKF = "ytMHQTb",
			FUTpWb = "JYgaPlYBAm",
			ywBwUIFSJbL =
			[[UJic oQrrxlKkZ zNGL fRd RhVOz lt hzGTjbc, ZyeACCh icuD suC "UPZmXFU" ykGi hdjr iWMG VB XRh next dWNMN, hIZLizYLR ipykI OIktKQzc and lzDpx PyTi ebi syNNiyvh zjqRe.

            - Eb vg gaKYID yaCDevtu Eszb l zFYsX HOdO vCqnF'y duMJ nrf rcDWSr in NAg knqacaw, XLX "hkeLkiA" dxFLGU CRdMC zt ul error XQnCDDs.]]
		}
	})
end